<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <title>Facturas | SR Kitchen</title>
    <link rel="stylesheet" th:href="@{/css/factura.css}" />
</head>
<body>

<nav class="menu-bar">
    <ul>
        <li><a href="/home" sec:authorize="hasAnyAuthority('ROLE_ADMIN','ROLE_MESERO')">Inicio</a></li>
        <li><a href="/mesa" sec:authorize="hasAnyAuthority('ROLE_ADMIN','ROLE_MESERO')">Mesa</a></li>
        <li><a href="/pedidos" sec:authorize="hasAnyAuthority('ROLE_ADMIN','ROLE_MESERO')">Pedidos</a></li>
        <li><a href="/factura" sec:authorize="hasAnyAuthority('ROLE_ADMIN','ROLE_MESERO')">Facturas</a></li>
        <li><a href="/mesero" sec:authorize="hasAuthority('ROLE_ADMIN')">Mesero</a></li>
        <li><a href="/platillos" sec:authorize="hasAuthority('ROLE_ADMIN')">Platillos</a></li>
        <li><a href="/datos" sec:authorize="hasAnyAuthority('ROLE_ADMIN')">Datos</a></li>
        <li class="logout-nav">
            <form th:action="@{/logout}" method="post" style="display:inline;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" style="background:#d9534f;">Cerrar Sesión</button>
            </form>
        </li>
    </ul>
</nav>

<main>
    <h1>Listado de Facturas</h1>

    <!-- Tabla con listado de facturas -->
    <div class="table-container">
        <table>
            <thead>
            <tr>
                <th>Mesa</th>
                <th>Mesero</th>
                <th>Fecha</th>
                <th>Total</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="f : ${facturas}">
                <td th:text="${f.mesaNum}">Mesa</td>
                <td th:text="${f.meseroName}">Mesero</td>
                <td th:text="${#temporals.format(f.fecha, 'dd/MM/yyyy HH:mm')}">Fecha</td>
                <td th:text="${#numbers.formatDecimal(f.total, 2, 'POINT', 0, 'COMMA')}">Total</td>

                <td>
                    <span th:if="${f.estado.name() == 'PENDIENTE'}"
                          style="color: #dc3545; font-weight: bold;">
                          ⏳ <span th:text="${f.estado}">PENDIENTE</span>
                        </span>

                    <span th:if="${f.estado.name() == 'APROBADA'}"
                          style="color: #28a745; font-weight: bold;">
                          ✅ <span th:text="${f.estado}">APROBADA</span>
                    </span>
                </td>

                <td>
                    <button type="button"
                            class="btn btn-info ver-detalle"
                            th:data-id="${f.id}"
                            th:data-url="@{/factura/detalle/}">Ver Detalle</button>
                </td>

            </tr>
            </tbody>
        </table>
    </div>

    <!-- Controles de paginación -->
    <div class="pagination">
        <a th:if="${currentPage > 0}"
           th:href="@{'/factura?page=' + ${currentPage - 1}}"
           class="page-btn">← Anterior</a>

        <span>Página
            <span th:text="${currentPage + 1}"></span>
            de <span th:text="${totalPages}"></span>
        </span>

        <a th:if="${currentPage + 1 < totalPages}"
           th:href="@{'/factura?page=' + ${currentPage + 1}}"
           class="page-btn">Siguiente →</a>
    </div>
</main>

<!-- MODAL para mostrar detalle de factura -->
<div id="modal-detalle" class="modal">
    <div class="modal-content">
        <span class="close" onclick="cerrarModal()">&times;</span>
        <div id="detalle-factura"></div>
    </div>
</div>

<script th:src="@{/js/factura-modal.js}"></script>

</body>
</html>

