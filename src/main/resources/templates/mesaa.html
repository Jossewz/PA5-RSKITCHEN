<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Restaurante Elite | Gestión de Mesas</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #3a8edb;
      --secondary-color: #1a1a1a;
      --accent-color: #87CEEB;
      --light-color: #ffffff;
      --dark-color: #333333;
      --success-color: #4CAF50;
      --warning-color: #FF9800;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: var(--dark-color);
    }

    .top-bar {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }

    .volver-btn {
      background-color: var(--light-color);
      color: var(--primary-color);
      border: none;
      padding: 12px 24px;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .volver-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 20px rgba(0,0,0,0.1);
      background-color: var(--accent-color);
      color: var(--light-color);
    }

    .main-container {
      padding: 100px 20px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: var(--light-color);
      font-family: 'Montserrat', sans-serif;
      font-size: 3rem;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
      margin-bottom: 30px;
      position: relative;
    }

    h1::after {
      content: '';
      display: block;
      width: 100px;
      height: 4px;
      background: var(--light-color);
      margin: 15px auto;
      border-radius: 2px;
    }

    .btn {
      background-color: var(--light-color);
      color: var(--primary-color);
      border: none;
      padding: 18px 36px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 25px rgba(0,0,0,0.2);
      background-color: var(--accent-color);
      color: var(--light-color);
    }

    .form-container {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.98);
      padding: 0;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
      z-index: 2000;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      animation: modalFadeIn 0.6s ease-out;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; transform: translate(-50%, -60%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    .form-header {
      padding: 15px 20px;
      cursor: move;
      background: rgba(58, 142, 219, 0.2);
      border-radius: 20px 20px 0 0;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .form-header h2 {
      color: var(--primary-color);
      font-family: 'Montserrat', sans-serif;
      font-size: 1.5rem;
      margin: 0;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--secondary-color);
      transition: var(--transition);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .close-btn:hover {
      color: var(--accent-color);
      transform: rotate(90deg);
      background: rgba(0,0,0,0.05);
    }

    .form-content {
      padding: 20px;
    }

    .form-group {
      margin-bottom: 25px;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--secondary-color);
      text-align: left;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid rgba(0,0,0,0.1);
      border-radius: 12px;
      font-size: 1rem;
      transition: var(--transition);
      background: rgba(255,255,255,0.8);
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(58, 142, 219, 0.3);
      background: var(--light-color);
    }

    .form-group textarea {
      min-height: 120px;
      resize: vertical;
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 15px;
    }

    .button-group button {
      padding: 15px 30px;
      border: none;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .guardar-btn {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      color: var(--light-color);
      box-shadow: 0 5px 15px rgba(70, 130, 180, 0.4);
    }

    .guardar-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(70, 130, 180, 0.6);
      background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
    }

    .cerrar-btn {
      background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
      color: var(--secondary-color);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .cerrar-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      background: linear-gradient(135deg, #e0e0e0, #f5f5f5);
    }

    .output {
      margin-top: 50px;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
    }

    .output h2 {
      color: var(--primary-color);
      font-family: 'Montserrat', sans-serif;
      font-size: 2rem;
      margin-bottom: 30px;
      text-align: center;
      position: relative;
    }

    .output h2::after {
      content: '';
      display: block;
      width: 80px;
      height: 4px;
      background: var(--primary-color);
      margin: 15px auto;
      border-radius: 2px;
    }

    .mesa-item {
      border-bottom: 1px solid rgba(0,0,0,0.1);
      padding: 25px;
      text-align: left;
      position: relative;
      transition: var(--transition);
      border-radius: 12px;
      margin-bottom: 15px;
      background: var(--light-color);
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    .mesa-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.1);
      border-bottom-color: transparent;
    }

    .mesa-item strong {
      color: var(--primary-color);
      font-weight: 600;
    }

    .mesa-item p {
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .edit-btn {
      position: absolute;
      right: 20px;
      top: 20px;
      background: linear-gradient(135deg, var(--warning-color), #FFC107);
      color: var(--light-color);
      border: none;
      padding: 10px 20px;
      border-radius: 50px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .edit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
      background: linear-gradient(135deg, #FFC107, var(--warning-color));
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #95a5a6;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    .floating-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 5px 20px rgba(70, 130, 180, 0.6);
      cursor: pointer;
      z-index: 100;
      transition: var(--transition);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .floating-btn:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 10px 30px rgba(70, 130, 180, 0.8);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .main-container {
        padding: 80px 20px 30px;
      }

      h1 {
        font-size: 2.2rem;
      }

      .form-container {
        width: 95%;
      }

      .form-header {
        padding: 12px 15px;
      }

      .form-content {
        padding: 15px;
      }

      .button-group {
        flex-direction: column;
      }

      .mesa-item {
        padding: 20px 15px;
      }

      .edit-btn {
        position: static;
        margin-top: 15px;
        width: 100%;
      }
    }

    @media (max-width: 576px) {
      h1 {
        font-size: 1.8rem;
      }

      .btn {
        padding: 15px 25px;
        font-size: 1rem;
      }

      .volver-btn {
        padding: 10px 15px;
        font-size: 0.9rem;
      }

      .output {
        padding: 20px;
      }
    }
  </style>
</head>
<body>

<div class="top-bar">
  <a href="/menu" class="volver-btn">
    <i class="fas fa-arrow-left"></i> Volver
  </a>
</div>

<div class="main-container">
  <h1><i class="fas fa-utensils"></i> Gestión de Mesas</h1>
  <div style="text-align: center;">
    <button class="btn" onclick="mostrarFormulario()">
      <i class="fas fa-plus-circle"></i> Llenar Mesa
    </button>
  </div>
</div>

<div class="form-container" id="formulario">
  <div class="form-header" id="formHeader">
    <h2 id="tituloFormulario">Nueva Mesa</h2>
    <button class="close-btn" onclick="cerrarFormulario()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="form-content">
    <div class="form-group">
      <label for="numeroMesa">Número de Mesa:</label>
      <input type="number" id="numeroMesa" required>
    </div>
    <div class="form-group">
      <label for="atendiendo">Atiende:</label>
      <input type="text" id="atendiendo" required>
    </div>
    <div class="form-group">
      <label for="orden">Orden:</label>
      <textarea id="orden" rows="3" required></textarea>
    </div>
    <div class="form-group">
      <label for="disponible">¿Disponible?</label>
      <select id="disponible">
        <option value="Sí">Sí</option>
        <option value="No">No</option>
      </select>
    </div>
    <div class="button-group">
      <button class="guardar-btn" onclick="guardarMesa()">
        <i class="fas fa-save"></i> Guardar
      </button>
      <button class="cerrar-btn" onclick="cerrarFormulario()">
        <i class="fas fa-times"></i> Cancelar
      </button>
    </div>
  </div>
</div>

<div class="output" id="listaMesas">
  <h2><i class="fas fa-list"></i> Mesas Registradas</h2>

  <div id="contenedorMesas">
    <!-- Las mesas se agregarán aquí dinámicamente -->
  </div>

  <div id="emptyState" class="empty-state" style="display: none;">
    <i class="fas fa-table"></i>
    <h3>No hay mesas registradas</h3>
    <p>Comienza agregando tu primera mesa</p>
  </div>
</div>

<a href="#listaMesas" class="floating-btn">
  <i class="fas fa-list"></i>
</a>

<script>
  let mesas = [];
  let editIndex = null;
  let isDragging = false;
  let offsetX, offsetY;

  function hacerArrastrable() {
    const formulario = document.getElementById("formulario");
    const header = document.getElementById("formHeader");

    header.addEventListener('mousedown', (e) => {
      if (e.target.tagName === 'BUTTON' || e.target.tagName === 'I') return;

      isDragging = true;
      const rect = formulario.getBoundingClientRect();
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;
      formulario.style.cursor = 'grabbing';
      formulario.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;

      e.preventDefault();

      // Calcular nueva posición
      let newX = e.clientX - offsetX;
      let newY = e.clientY - offsetY;

      // Limitar al área visible
      const ventanaWidth = formulario.offsetWidth;
      const ventanaHeight = formulario.offsetHeight;

      newX = Math.max(0, Math.min(newX, window.innerWidth - ventanaWidth));
      newY = Math.max(0, Math.min(newY, window.innerHeight - ventanaHeight));

      formulario.style.left = `${newX}px`;
      formulario.style.top = `${newY}px`;
      formulario.style.transform = 'none';
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
      formulario.style.cursor = '';
      formulario.style.userSelect = '';
    });
  }

  function mostrarFormulario() {
    const formulario = document.getElementById("formulario");
    formulario.style.display = "block";
    formulario.style.left = "50%";
    formulario.style.top = "50%";
    formulario.style.transform = "translate(-50%, -50%)";

    document.getElementById("tituloFormulario").textContent = editIndex !== null ? "Editar Mesa" : "Nueva Mesa";

    if (editIndex === null) {
      limpiarFormulario();
    }
  }

  function cerrarFormulario() {
    const formulario = document.getElementById("formulario");
    formulario.style.animation = "modalFadeIn 0.4s reverse forwards";
    setTimeout(() => {
      formulario.style.display = "none";
      formulario.style.animation = "modalFadeIn 0.6s ease-out";
      formulario.style.left = "50%";
      formulario.style.top = "50%";
      formulario.style.transform = "translate(-50%, -50%)";
    }, 400);
    editIndex = null;
  }

  function limpiarFormulario() {
    document.getElementById("numeroMesa").value = "";
    document.getElementById("atendiendo").value = "";
    document.getElementById("orden").value = "";
    document.getElementById("disponible").value = "Sí";
  }

  function guardarMesa() {
    const numero = document.getElementById("numeroMesa").value;
    const atendiendo = document.getElementById("atendiendo").value;
    const orden = document.getElementById("orden").value;
    const disponible = document.getElementById("disponible").value;

    if (!numero || !atendiendo || !orden) {
      alert("Por favor complete todos los campos requeridos.");
      return;
    }

    const btnGuardar = document.querySelector('.guardar-btn');
    btnGuardar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
    btnGuardar.disabled = true;

    setTimeout(() => {
      const mesaData = {
        numero,
        atendiendo,
        orden,
        disponible,
        fecha: new Date().toLocaleString()
      };

      if (editIndex !== null) {
        mesas[editIndex] = mesaData;
        actualizarMesaEnUI(mesaData);
      } else {
        mesas.push(mesaData);
        agregarMesaAUi(mesaData);
      }

      btnGuardar.innerHTML = '<i class="fas fa-save"></i> Guardar';
      btnGuardar.disabled = false;
      cerrarFormulario();
      actualizarEstadoVacio();
    }, 800);
  }

  function agregarMesaAUi(mesa) {
    const contenedor = document.getElementById("contenedorMesas");
    const mesaDiv = document.createElement("div");
    mesaDiv.className = "mesa-item";
    mesaDiv.dataset.id = mesa.numero;
    mesaDiv.innerHTML = crearHTMLMesa(mesa);
    contenedor.prepend(mesaDiv);

    // Animación de entrada
    setTimeout(() => {
      mesaDiv.style.animation = "fadeInUp 0.5s ease-out both";
    }, 100);
  }

  function actualizarMesaEnUI(mesa) {
    const mesaDiv = document.querySelector(`.mesa-item[data-id="${mesa.numero}"]`);
    if (mesaDiv) {
      mesaDiv.innerHTML = crearHTMLMesa(mesa);
    }
  }

  function crearHTMLMesa(mesa) {
    return `
      <div class="mesa-info">
        <p><strong>Mesa #:</strong> ${mesa.numero}</p>
        <p><strong>Atiende:</strong> ${mesa.atendiendo}</p>
        <p><strong>Orden:</strong> ${mesa.orden}</p>
        <p><strong>Disponible:</strong> ${mesa.disponible}</p>
        <p><small><strong>Actualizado:</strong> ${mesa.fecha}</small></p>
      </div>
      <button class="edit-btn" onclick="editarMesa('${mesa.numero}')">
        <i class="fas fa-edit"></i> Editar
      </button>
    `;
  }

  function editarMesa(numero) {
    const index = mesas.findIndex(m => m.numero === numero);
    if (index === -1) return;

    const mesa = mesas[index];
    document.getElementById("numeroMesa").value = mesa.numero;
    document.getElementById("atendiendo").value = mesa.atendiendo;
    document.getElementById("orden").value = mesa.orden;
    document.getElementById("disponible").value = mesa.disponible;

    editIndex = index;
    mostrarFormulario();
  }

  function actualizarEstadoVacio() {
    const emptyState = document.getElementById("emptyState");
    emptyState.style.display = mesas.length === 0 ? "block" : "none";
    document.getElementById("listaMesas").style.display = mesas.length > 0 ? "block" : "none";
  }

  // Inicializar
  document.addEventListener('DOMContentLoaded', () => {
    hacerArrastrable();
    actualizarEstadoVacio();

    // Animación de entrada para las mesas existentes
    setTimeout(() => {
      document.querySelectorAll('.mesa-item').forEach((mesa, index) => {
        mesa.style.animation = `fadeInUp 0.5s ease-out ${index * 0.1}s both`;
      });
    }, 300);
  });
</script>

</body>
</html>